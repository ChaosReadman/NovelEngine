<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="utf-8">
    <title>game engine</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="js/Sprite-0001.js"></script>
    <script src="js/Futaba.js"></script>
    <script src="js/gengine.js"></script>

    <script>
        var ClickedX;
        var ClickedY;
        var bg = (spr) => {
            spr.context.fillStyle = "rgb(255 165 0)";;
            spr.context.fillRect(0, 0, spr.context.canvas.width, spr.context.canvas.height);
        }

        var MebaeToIdle = (spr) => {
            if (spr.currentFrame == spr.currentFrameTagTo) {
                spr.setTag("Idle");
            }
        }

        function getRandomInt(max) {
            return Math.floor(Math.random() * max);
        }

        async function dispatch() {
            var x = 32 + getRandomInt(640 - 64);
            var y = 32 + getRandomInt(480 - 64);
            console.log("dispatched", x, y)
            var sp = await Sprite.build("Futaba", jsMebae, "Mebae", x, y, 1, 0);
            sp.addPhysic(MebaeToIdle);
            gPrim.append(sp);
            nextTime = 3 + getRandomInt(5) * 1000;
            setTimeout(dispatch, nextTime);
        }

        async function init() {
            gPrim = new Primitive(document.getElementById("canvas").getContext("2d"));

            var sprBg = new Sprite("BG", null, "", 0, 0, 0, 0);
            sprBg.addPhysic(bg);
            gPrim.append(sprBg);
            gPrim.run();
            var c = document.getElementById("canvas");

            c.addEventListener('click', function (event) {
                ClickedX = event.offsetX;
                ClickedY = event.offsetY;
                var ctx = this.getContext("2d");
                ctx.beginPath();
                ctx.arc(ClickedX, ClickedY, 32, 0, 2 * Math.PI);
                ctx.stroke();
                console.log("clicked", ClickedX, ClickedY);

            }, false);
            dispatch();
        }
    </script>

</head>

<body onload="init();">
    <center>
        <h2>ゲームエンジンの例</h2>
        <canvas id="canvas" width="640" height="480" />
    </center>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>


</body>

</html>